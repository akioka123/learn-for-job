# 047
## A/Bテストの実施
要件
1. パフォーマンス影響を抑える。
1. 一部コンテンツは最大24時間キャッシュされる。
1. CloudFrontを使用している。

結果 \
CloudFrontにはルーティングの機能はないので、Route53による加重ルーティングでA/Bテストを実施する。
Blue/Greenデプロイにも利用可能

### CloudFront
- 世界に点在するエッジサービス（CDN）。リージョンのコンテンツをキャッシュし、顧客に高速でコンテンツを届ける。
- キャッシュ機能を持つ。キャッシュの無効化にはコストがかかる。

## ロールバックの高速化
要件
1. アプリはEC2上で動作している。
1. 負荷分散にELBを使用している。
1. 前回のロールバックには4時間かかっている。
   
結果 \
AWS Opsworks スタックを使用してアプリを再度デプロイし、DeploymentCommandを使用して障害時にロールバックを実施する。

## DBの耐障害性と高可用性
要件
1. MySQLを使用する。
2. 耐障害性と高可用性を確保する。

結果 \
複数のAZにインスタンスを作成する。インスタンス間でレプリケーションを有効にする。
マルチAZ配置を有効にする。

## ピーク時のレイテンシーの削減
要件
1. ピーク時の応答時間が予想よりも長くなっている。
2. 環境のスケーリングにはAutoScalingを使用している。

結果 \
AutoScalingグループの最大サーバー数を増加する。
ピーク時に応答が長くなっているので、スケールアウトの台数を増加することで対応する。
処理中・処理待ちのリクエスト数などのアプリケーションに関する詳細な情報を含むカスタムメトリクスをCloudWatchにプッシュする。

## AutoScalingのインスタンスの更新
要件
1. ELBを備えたAutoScalingグループ
2. 全てのインスタンスを段階的に廃止し、新しいインスタンスに置き換える。

結果 \
古いインスタンスを削除しながら、ELBの背後に追加のAutoScaling設定をアタッチし、新しいインスタンスを段階的に作成する。（スケールアウト時に新しい設定に基づいてインスタンスが作成される。）
スケールインの際に、終了ポリシーによって終了するインスタンスを選択できる。
終了ポリシーでOldestLaunchConfigurationを使用して最も古いインスタンスを削除する。
以前の設定を使用しているインスタンスを廃止する。
終了ポリシーでNewestInstanseを選択すると、最も新しいインスタンスが削除される。

## デプロイ戦略の形式化
要件
1. コードリポジトリに標準的なgitコマンドを使用する。
2. 管理ツールはAWSのプラットフォームソリューションを最大限に活用する。
3. デプロイパッケージは変更不可能、Dockerイメージの形式である。

## インフラ管理・AWS環境の構築
要件
1. 開発環境には、ALB、EC2、AutoScaling、セキュリティグループ、DynamoDBなどが共通規格としてある。
2. 開発環境の作成を自動化する。
3. 必要なインフラの増加が予想されるので、デプロイしたインフラを簡単に更新できる方法が必要である。
4. CloudFormationを使用する。
   
結果\
ネストされたスタックを使用して、共通規格となる開発環境を定義する。
ネストされたスタック内でFn:ImportValueを使用することで、作成・出力されるVPCとサブネット値を取得する。CreateChangeSet、ExecuteChangeSetコマンドを使用して、既存の開発環境スタックを更新する。

# 01
## ハイブリットなデプロイの自動化
要件
1. アプリは機密性の高い認証情報を含むDBにアクセスする。
2. インスタンスはDBの認証情報にアクセスする。
3. DBの認証情報は保留中、転送中に暗号化されなければならない。

結果\
AWS・オンプレミス両方にデプロイするためにCodeDeployを使用する。
AWSSystemsManagerのパラメータストアを使用して、安全な文字列を作成使用する。EC2とオンプレミスそれぞれのサーバに関連付けられたロールにIAMポリシーをアタッチする。

## EC2のOSとコアアプリをパッチ更新する
要件
1. OSとコアアプリケーションのパッチを更新する。
2. サーバーのパッチレベルに一貫性を持たせる。

結果\
SystemsManagaerPatchManagerを使用する。
すべてのサーバーにSystemsManagerエージェントをインストールする。
メンテナンスウィンドウ中にパッチ更新を行う。